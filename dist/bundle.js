!function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(4),s=i(n(2)),o=i(n(1)),u=i(n(5)),l=i(n(6)),c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.status=0,this.startTime=null,this.endTime=null,this.bugTime=Date.now(),this.allEnemies=[],this.allGems=[],this.allRocks=[],this.key=null,this.heart=null,this.score=0,this.lives=3,this.player=new r.Player}return a(e,[{key:"update",value:function(){function e(e){e.forEach(function(t,n){t.x>600&&e.splice(n,1)})}Date.now()-this.bugTime>1e3&&(this.bugTime=Date.now(),this.allEnemies.push(new r.Enemy)),e(this.allRocks),e(this.allGems),e(this.allEnemies),null!==this.key&&this.key.x>600&&(this.key=null),null!==this.heart&&this.heart.x>600&&(this.heart=null)}},{key:"rollMap",value:function(){function e(e){Array.isArray(e)?e.forEach(function(e){e.x+=101}):e instanceof r.Entity&&(e.x+=101)}e(this.allEnemies),e(this.allGems),e(this.allRocks),e(this.key),e(this.heart),Math.floor(100*Math.random())%5==0&&this.allGems.push(new r.Gem),Math.floor(100*Math.random())%7==0&&this.allRocks.push(new r.Rock),null===this.key&&Math.floor(100*Math.random())%13==0&&(this.key=new r.Key),null===this.heart&&Math.floor(100*Math.random())%17==0&&(this.heart=new r.Heart)}},{key:"reset",value:function(){this.player.reset(),this.allEnemies=[],this.allGems=[],this.allRocks=[]}},{key:"checkCollisions",value:function(){var e=this;this.player.y<73&&(this.showError("擦，跳河了"),this.subtractLife()),this.allEnemies.forEach(function(t){e.checkCollision(e.player.x,e.player.y,t.x,t.y)&&(e.showError("擦，出车祸了"),e.subtractLife())}),this.allGems.forEach(function(t,n){e.checkCollision(e.player.x,e.player.y,t.x,t.y)&&e.pickGem(n)}),null!==this.key&&this.checkCollision(this.player.x,this.player.y,this.key.x,this.key.y)&&this.pickKey(),null!==this.heart&&this.checkCollision(this.player.x,this.player.y,this.heart.x,this.heart.y)&&this.pickHeart()}},{key:"checkCollision",value:function(e,t,n,i){return Math.abs(e-n)<60&&Math.abs(t-i)<60}},{key:"pickGem",value:function(e){var t=this.allGems[e].score;this.score+=t,this.allGems.splice(e,1),this.showPositive("捡到宝石，增加 "+t+" 分")}},{key:"pickKey",value:function(){this.allEnemies=[],this.key=null,this.showPositive("释放大招")}},{key:"pickHeart",value:function(){this.lives++,this.heart=null,this.showPositive("生命加一")}},{key:"subtractLife",value:function(){this.lives--,this.reset(),this.lives<1&&this.end()}},{key:"renderPanel",value:function(){(0,u.default)(".panel .time.value").text(this.duration),(0,u.default)(".panel .scores.value").text(this.score);var e=void 0;if(this.lives>0){e=[];for(var t=0;t<this.lives;t++)e.push('<i class="heart icon"></i>');e=e.join("")}else e="<span>Game Over</span>";(0,u.default)(".panel .lives.value").html(e),(0,u.default)(".panel .char.value img").attr("src",this.player.sprite)}},{key:"showPositive",value:function(e){this._showMessage(e,"positive")}},{key:"showError",value:function(e){this._showMessage(e,"error")}},{key:"_showMessage",value:function(e,t){(0,u.default)(".ui."+t+".message").show(function(){var n=this;(0,u.default)(".ui."+t+".message > p").text(e),setTimeout(function(){(0,u.default)(n).hide()},2e3)})}},{key:"start",value:function(){this.status=1,this.startTime=Date.now()}},{key:"restart",value:function(){this.lives=3,this.score=0,this.status=1,this.startTime=Date.now(),this.reset()}},{key:"end",value:function(){var e=this,t=this;(0,u.default)(".ui.game-over.modal .time.value").text(this.duration),(0,u.default)(".ui.game-over.modal .score.value").text(this.score),(0,u.default)(".ui.game-over.modal").modal({closable:!1,onApprove:function(){t.restart()}}).modal("show"),this.endTime=Date.now(),setTimeout(function(){e.status=2},0)}},{key:"init",value:function(){this.loadResources(),this.initController(),this.initPanel()}},{key:"loadResources",value:function(){o.default.load(["images/stone-block.png","images/water-block.png","images/grass-block.png","images/enemy-bug.png","images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png","images/gem-blue.png","images/gem-green.png","images/gem-orange.png","images/rock.png","images/heart.png","images/key.png"]),o.default.onReady(s.default.init.bind(s.default))}},{key:"initController",value:function(){var e=this;o.default.onReady(function(){document.addEventListener("keyup",function(t){e.player.handleInput({37:"left",38:"up",39:"right",40:"down"}[t.keyCode])}),(0,u.default)(".btn-start").one("click",function(){e.start(),(0,u.default)(".btn-start").addClass("disabled")})})}},{key:"initPanel",value:function(){(0,u.default)(".btn-change-char").popup(),(0,u.default)(".btn-change-char").click(function(){(0,u.default)(".ui.char-change.modal").modal("show")});var e=[],t=!0,n=!1,i=void 0;try{for(var a,s=r.Player.sprites[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var o=a.value;e.push('<div class="ui medium image">\n        <a href="#" class="btn-char" data-sprite="'+o+'">\n          <img src="'+o+'">\n        </a>\n      </div>')}}catch(e){n=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw i}}(0,u.default)(".ui.char-change.modal .image.content").html(e.join(""));var l=this;(0,u.default)(".ui.char-change.modal .btn-char").click(function(){l.player.sprite=(0,u.default)(this).data("sprite"),l.renderPanel(),(0,u.default)(".ui.char-change.modal").modal("hide")})}},{key:"isRunning",get:function(){return 1===this.status}},{key:"duration",get:function(){function e(e){return e<10?"0"+e:""+e}if(0===this.status)return"00:00:00";var t=void 0,n=(t=1===this.status?l.default.duration(Date.now()-this.startTime):l.default.duration(this.endTime-this.startTime)).get("hours"),i=t.get("minutes"),a=t.get("seconds");return e(n)+":"+e(i)+":"+e(a)}}]),e}();t.default=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resourceCache={},this.readyCallbacks=[]}return i(e,[{key:"load",value:function(e){e instanceof Array?e.forEach(function(e){this._load(e)}.bind(this)):this._load(e)}},{key:"get",value:function(e){return this.resourceCache[e]}},{key:"isReady",value:function(){var e=!0;for(var t in this.resourceCache)this.resourceCache.hasOwnProperty(t)&&!this.resourceCache[t]&&(e=!1);return e}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"_load",value:function(e){if(this.resourceCache[e])return this.resourceCache[e];var t=new window.Image;t.onload=function(){this.resourceCache[e]=t,this.isReady()&&this.readyCallbacks.forEach(function(e){e()})}.bind(this),this.resourceCache[e]=!1,t.src=e}}]),e}();t.default=new a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=i(n(1)),s=i(n(0)),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastTime=Date.now(),this.canvas=document.querySelector("canvas"),this.ctx=this.canvas.getContext("2d")}return a(e,[{key:"main",value:function(){var e=Date.now(),t=(e-this.lastTime)/1e3;s.default.isRunning&&(this.update(t),this.renderBoard(),this.renderEntities()),this.lastTime=e,window.requestAnimationFrame(this.main.bind(this))}},{key:"init",value:function(){this.lastTime=Date.now(),this.renderBoard(),this.main()}},{key:"update",value:function(e){s.default.update(),s.default.allEnemies.forEach(function(t){t.update(e)}),s.default.checkCollisions()}},{key:"renderBoard",value:function(){for(var e=["images/water-block.png","images/stone-block.png","images/stone-block.png","images/stone-block.png","images/grass-block.png","images/grass-block.png"],t=0;t<6;t++)for(var n=0;n<5;n++)this.ctx.drawImage(r.default.get(e[t]),101*n,83*t);s.default.renderPanel()}},{key:"renderEntities",value:function(){s.default.player.render(),s.default.allGems.forEach(function(e){e.render()}),null!==s.default.heart&&s.default.heart.render(),null!==s.default.key&&s.default.key.render(),s.default.allRocks.forEach(function(e){e.render()}),s.default.allEnemies.forEach(function(e){e.render()})}}]),e}();t.default=new o},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{default:e}}(n(0));i.default.init(),window.game=i.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){return f[Math.floor(10*Math.random())%f.length]}Object.defineProperty(t,"__esModule",{value:!0}),t.Heart=t.Key=t.Rock=t.Gem=t.Player=t.Enemy=t.Entity=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=i(n(2)),c=i(n(0)),h=i(n(1)),f=[63,146,229,312,395],d=function(){function e(){if(s(this,e),new.target===e)throw new Error("不可以实例化抽象类")}return u(e,[{key:"update",value:function(){throw new Error("抽象方法")}},{key:"render",value:function(){l.default.ctx.drawImage(h.default.get(this.sprite),this.x,this.y)}}]),e}(),y=function(e){function t(){s(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.sprite="images/enemy-bug.png",e.x=-100,e.y=o(),e}return r(t,d),u(t,[{key:"update",value:function(e){this.x+=150*e}}]),t}(),p=function(e){function t(){s(this,t);var e=["images/gem-blue.png","images/gem-green.png","images/gem-orange.png"],n=Math.floor(10*Math.random())%e.length,i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.x=-103,i.y=o()-10,i.score=100*(n+1),i.sprite=e[n],i}return r(t,d),t}(),g=function(e){function t(){s(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.sprite="images/rock.png",e.x=-103,e.y=o(),e}return r(t,d),t}(),m=function(e){function t(){s(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.sprite="images/key.png",e.x=-103,e.y=o(),e}return r(t,d),t}(),v=function(e){function t(){s(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.sprite="images/heart.png",e.x=-103,e.y=o(),e}return r(t,d),t}(),k=function(e){function t(){s(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.sprite=t.sprites[0],e.x=202,e.y=405,e.yPace=83,e.xPace=101,e}return r(t,d),u(t,[{key:"handleInput",value:function(e){function t(e,t){var n=!0,i=!1,a=void 0;try{for(var r,s=c.default.allRocks[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var o=r.value;if(c.default.checkCollision(e,t,o.x,o.y))return!0}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return!1}if("left"===e&&this.x>0){if(t(this.x-this.xPace,this.y))return;this.x>202?this.x-=this.xPace:c.default.rollMap()}else if("right"===e&&this.x<400){if(t(this.x+this.xPace,this.y))return;this.x+=this.xPace}else if("up"===e&&this.y>0){if(t(this.x,this.y-this.yPace))return;this.y-=this.yPace}else if("down"===e&&this.y<400){if(t(this.x,this.y+this.yPace))return;this.y+=this.yPace}}},{key:"reset",value:function(){this.x=202,this.y=405}}]),t}();k.sprites=["images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png"],t.Entity=d,t.Enemy=y,t.Player=k,t.Gem=p,t.Rock=g,t.Key=m,t.Heart=v},function(e,t){e.exports=jQuery},function(e,t){e.exports=moment}]);